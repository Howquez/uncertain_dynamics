{{ block scripts }}
<script src="{% static 'global/js/buttons.js' %}"></script>
<script src="{% static 'global/js/modal_with_timer.js' %}"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
{{ endblock }}

{{ block global_styles  }}
<style>
    .otree-title {
        display: none;
        }
</style>
{{ endblock }}

{{ block styles }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.2/font/bootstrap-icons.css">
{{ endblock }}


{{ block content }}
<body class="bg-light.bg-gradient">

    <!-- Header -->
    <nav class="navbar navbar-inverse sticky-top bg-white border-bottom justify-content-between" style="z-index:1">
        <h5 class="text-center">
            Instructions
        </h5>
        <div class="me-2 text-secondary" style="cursor: pointer;">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="dark" class="bi bi-calculator" viewBox="0 0 16 16" data-bs-toggle="offcanvas" data-bs-target="#offcanvasCalculator" aria-controls="offcanvasCalculator" id="calculator_icon">
                <path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h8zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4z"/>
                <path d="M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-2zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-4z"/>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="dark" class="bi bi-info-circle-fill ms-2" viewBox="0 0 16 16" data-bs-toggle="offcanvas" data-bs-target="#offcanvasInstructions" aria-controls="offcanvasInstructions" id="instructions_icon">
                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412l-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
            </svg>
        </div>
    </nav>

    <div class="modal fade" id="modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <h4 class="mt-3">
                        Process
                    </h4>

                    <p>
                        The next few pages will guide you through the instructions.
                        On each page, we'll ask at least one comprehension question.
                    </p>

                    <p>
                        If you want to re-read the instructions at any later point during the study,
                        you can do so by clicking on the <i class="bi bi-info-circle-fill"></i> icon on top of your screen.
                    </p>
                    <p>
                        Next to it, the <i class="bi bi-calculator"></i> icon helps you to consider different cases and to calculate
                        the outcomes of different scenarios during the decision stage.
                        We'll explain that in what follows.
                    </p>

                </div>
                <div class="d-flex justify-content-center modal-footer border-top-0">
                    <button type="button" id="modal_button" class="btn btn-outline-primary" data-bs-dismiss="modal">Understood</button>
                </div>
            </div>
        </div>
    </div>


    <div class="container">
        <div class="row justify-content-center">
            <div class="col-sm-10 col-md-10 col-lg-8">
                <!-- Decision Card -->
                <div class="card rounded mt-3 shadow-lg">
                    <div class="card-body">

                        <h4 class="mt-3">
                            Overview
                        </h4>

                        <p>
                            You are about to participate in a decision-making study. If you follow the instructions
                            carefully, you can earn a considerable amount of money that depends on your decisions and the
                            decisions of three other participants.
                            <u>Your earnings will be transferred as bonus payments.</u>
                        </p>

                        <p>
                            Throughout the study you will make decisions about amounts of tokens. At the end of the
                            study all tokens you have will be converted into British pound sterling at the <u>exchange rate
                            Â£{{ session.config.real_world_currency_per_point }} for 1 point</u> in addition to a
                            show-up fee of {{ session.config.participation_fee }}.
                        </p>

                        <p>
                            The study will consist of <u>{{ session.config.num_rounds }} decision making periods</u>
                            as well as a brief questionnaire.
                            At the beginning of the study, you will be matched with three other participants.
                            Therefore, there are four people, including yourself, participating in your group.
                            <u>You will be matched with the same three participants during the entire study.</u>
                            None of the participants knows anything about other participants' identities.
                        </p>

                        <p>
                            We value your time and don't want you to wait too long for other group members to make their
                            decisions. For this reason, we restrict the time each participant has to make his or her
                            decision to five minutes in the first period and two and a half minutes in the subsequent periods.
                            If a participant exceeds that time limit, he or she drops out of the study and is
                            replaced by a bot to ensure a smooth experience for all other group members.
                            You will be notified if that happens.
                        </p>

                        <p>
                            All your decisions will be treated confidentially. This means that
                            none of the other participants will know who you are and which decisions you made.
                            Likewise, you will not be able to learn the identity of your group members.
                            Whereas we will provide some information about each participant's previous decision,
                            we will mask them to establish anonymity.
                        </p>

                        <p>
                            Before the first period, each participant will be given an
                            <u>initial endowment of {{ session.config.initial_endowment }} tokens</u>.
                        </p>

                        <hr class="">

                        <small>
                            {{ formfields }}
                        </small>
                        <!--
                        <p>
                            Here comes a question.
                        </p>

                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                            <label class="form-check-label" for="flexRadioDefault1">
                                Default radio
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2" checked>
                            <label class="form-check-label" for="flexRadioDefault2">
                                Default checked radio
                            </label>
                        </div>
                        -->


                        <div class="d-flex justify-content-center mt-5 mb-3">
                            <button class="btn btn-outline-primary" type="submit" id="submitButton">
                                Submit
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Instructions Offcanvas -->
        <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasInstructions" aria-labelledby="offcanvasInstructionsLabel">
            <div class="offcanvas-header">
                <h4 class="offcanvas-title" id="offcanvasInstructionsLabel">Instructions</h4>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <div>
                    {{ include C.EARNINGS_TEMPLATE }}
                </div>

                <h4 class="mt-5">
                    Events
                </h4>
                <div>
                    {{ include C.SHOCKS_TEMPLATE }}
                </div>
            </div>
        </div>

    <!-- Calculator Offcanvas -->
        <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasCalculator" aria-labelledby="offcanvasCalculatorLabel" style="min-width: 25vw;">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="offcanvasCalculatorLabel">Calculator</h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <div>
                    This calculator is designed to guide your decision. Given a return rate of approximately {{ min_mpcr }}% as well as
                    your intended allocation, you can make an assumption about the other players' average allocation and
                    whether a shock will occur to calculate your return.
                </div>


                <div class="form-check form-switch mt-4">
                    <input class="form-check-input" type="checkbox" role="switch" id="eweFlexSwitch">
                    <label class="form-check-label" for="eweFlexSwitch">Assume an event occurs?</label>
                </div>
                <div class="form-floating mt-2">
                    <input type="number" class="form-control" id="othersContributions" placeholder="0" value="0" min="0">
                    <label for="othersContributions">Other players' average allocation</label>
                </div>
                <div class="form-floating mt-2">
                    <input type="number" class="form-control" id="yourContribution" placeholder="0" value="0" min="0">
                    <label for="yourContribution">Your intended allocation</label>
                </div>
                <div class="form-floating mt-2">
                    <input type="number" class="form-control" id="yourReturn" placeholder="0" value="0" min="0" disabled>
                    <label for="yourContribution">Your expected return</label>
                </div>
                <button type="button" id="calculator_button" class="btn-primary btn mt-2 w-100" disabled>
                    Calculate
                </button>
                <small class="text-danger">
                    The calculator is disabled in this instructions-stage. It will be enabled on the decision screen.
                </small>

                <p class="h6 mt-5"> Further details <small>given the return rate of approximately {{min_mpcr}}%</small></p>
                <div class="table-responsive mt-2">
                    <table class="table table-hover">
                        <thead>
                        </thead>
                        <tr>
                            <td> Your current endowment </td>
                            <td> {{ session.config.initial_endowment }} </td>
                        </tr>
                        <tr>
                            <td> Others' average allocation</td>
                            <td id="othersContributionsTable"> 0 </td>
                        </tr>
                        <tr>
                            <td> Your intended allocation</td>
                            <td id="yourContributionTable"> 0 </td>
                        </tr>
                        <tr>
                            <td> Your expected return</td>
                            <td id="yourReturnTable"> 0 </td>
                        </tr>
                        <thead>
                        <td> Your expected endowment </td>
                        <td id="yourEndowmentTable">{{ session.config.initial_endowment }}</td>
                        </thead>
                    </table>
                </div>
            </div>
        </div>

</body>
{{ endblock }}